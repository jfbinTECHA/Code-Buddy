{
  "name": "Bytebot Mission Control Sync",
  "type": "task",
  "commands": [
    "echo 'üõ∞Ô∏è Starting Bytebot Mission Control Sync...'",
    "echo 'üì° Checking agent status (9991/9990)...'",
    "port=9991; status=$(curl -s -o /dev/null -w '%{http_code}' http://localhost:$port/api/ops/health)",
    "if [ \"$status\" -ne 200 ]; then port=9990; status=$(curl -s -o /dev/null -w '%{http_code}' http://localhost:$port/api/ops/health); fi",
    "if [ \"$status\" -eq 200 ]; then echo '‚úÖ Agent online at port '$port; else echo '‚ùå Agent offline ‚Äî triggering quick health check fallback'; fi",
    "echo 'üß† Running quick health metrics...'",
    "python3 Code-Buddy/bytebotd/ops/bytebot_health.py > /tmp/bytebot_health.log",
    "uptime=$(grep 'bytebot-agent' /tmp/bytebot_health.log | awk '{print $NF}')",
    "mem=$(grep 'bytebot-ui' /tmp/bytebot_health.log | awk '{print $NF}')",
    "timestamp=$(date -u +%Y-%m-%dT%H:%M:%SZ)",
    "echo 'üìà Sending live metrics heartbeat to /metrics endpoint...'",
    "curl -s -X POST http://localhost:$port/api/metrics/update -H 'Content-Type: application/json' -d '{\"timestamp\":\"'$timestamp'\",\"uptime\":\"'$uptime'\",\"memory\":\"'$mem'\"}' >/dev/null 2>&1 || echo '‚ö†Ô∏è Metrics endpoint not writable (fallback mode)'",
    "echo 'üì° Sending mission sync summary to Discord webhook (if configured)...'",
    "if [ -n \"$BYTEBOT_DISCORD_WEBHOOK\" ]; then curl -s -H 'Content-Type: application/json' -d '{\"embeds\":[{\"title\":\"üõ∞Ô∏è Bytebot Mission Control Sync\",\"description\":\"Agent status: '$status' on port '$port'\\nUptime: '$uptime'\\nMemory: '$mem'\\nTime: '$timestamp'\",\"color\":3066993}]}' \"$BYTEBOT_DISCORD_WEBHOOK\" >/dev/null; else echo '‚ö†Ô∏è No Discord webhook configured.'; fi",
    "echo '‚úÖ Mission Control Sync complete.'"
  ]
}