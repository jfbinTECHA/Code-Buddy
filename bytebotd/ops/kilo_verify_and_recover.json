{
  "name": "Bytebot Verify and Recover",
  "type": "task",
  "commands": [
    "echo 'ðŸ” Checking for ops controller files (depth â‰¤ 3)...'",
    "docker exec bytebot-desktop timeout 10 find /bytebot -maxdepth 3 -type f -iname '*ops*' 2>/dev/null | grep -v 'node_modules' | grep -v '.cache' | grep -v 'dist' || echo 'âš ï¸  No matching files or search timed out.'",
    "echo 'âœ… File scan done. Now testing the ops controller health endpoint...'",
    "status=$(curl -s -o /dev/null -w '%{http_code}' http://localhost:9991/)",
    "if [ \"$status\" -eq 200 ]; then",
    "  echo 'âœ… Ops endpoint responding on port 9991 (HTTP 200)'",
    "  port=9991",
    "else",
    "  status2=$(curl -s -o /dev/null -w '%{http_code}' http://localhost:9990/)",
    "  if [ \"$status2\" -eq 200 ]; then",
    "    echo 'âœ… Ops endpoint responding on port 9990 (HTTP 200)'",
    "    port=9990",
    "  else",
    "    echo 'âŒ Could not reach Bytebot Agent on ports 9991 or 9990.'",
    "    echo 'ðŸ©º Attempting automated recovery...'",
    "    bash Code-Buddy/bytebotd/ops/recover_bytebot.sh",
    "    echo 'â³ Rechecking after recovery...'",
    "    sleep 5",
    "    retry=$(curl -s -o /dev/null -w '%{http_code}' http://localhost:9991/)",
    "    if [ \"$retry\" -eq 200 ]; then echo 'âœ… Bytebot Agent recovered on port 9991.'; port=9991; else retry2=$(curl -s -o /dev/null -w '%{http_code}' http://localhost:9990/); if [ \"$retry2\" -eq 200 ]; then echo 'âœ… Bytebot Agent recovered on port 9990.'; port=9990; else echo 'ðŸš¨ Recovery attempt failed. Manual intervention required.'; fi; fi",
    "  fi",
    "fi",
    "echo 'ðŸ“Š Running detailed health metrics report...'",
    "python3 Code-Buddy/bytebotd/ops/bytebot_health.py > /tmp/bytebot_health_report.txt 2>&1",
    "summary=$(grep -E 'ðŸŸ¢|ðŸ”´|âš ï¸' /tmp/bytebot_health_report.txt | tr '\\n' ' ')",
    "echo 'ðŸ“¡ Sending summary to Discord...'",
    "curl -s -H 'Content-Type: application/json' -d '{\"embeds\":[{\"title\":\"ðŸ“¡ Bytebot Verification Report\",\"description\":\"'$summary'\",\"color\":3066993}]}' \"$BYTEBOT_DISCORD_WEBHOOK\" > /dev/null 2>&1",
    "echo 'âœ… Bytebot verification and reporting complete. Agent healthy on port '$port'.'"
  ]
}