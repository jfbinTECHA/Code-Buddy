{"version":3,"file":"azure-ad.provider.js","sourceRoot":"","sources":["../../../src/authz/providers/azure-ad.provider.ts"],"names":[],"mappings":";;;AAAA,uEAAoD;AACpD,2EAAuE;AAG1D,QAAA,oBAAoB,GAAwB;IACvD,IAAI,EAAE,UAAU;IAChB,WAAW,EAAE,oBAAoB;IACjC,QAAQ,EAAE,mCAAQ;IAClB,eAAe,EAAE,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,YAAY,EAAE,YAAY,EAAE,EAAE,EAAE,CAAC,CAAC;QACzE,QAAQ,EAAE,QAAQ;QAClB,YAAY,EAAE,YAAY;QAC1B,WAAW,EAAE,IAAA,sCAAiB,EAAC,GAAG,SAAS,IAAI,YAAY,EAAE,CAAC;QAC9D,MAAM,EAAE,QAAQ;QAChB,QAAQ,EAAE,8BAA8B;KACzC,CAAC;IACF,KAAK,EAAE,CAAC,QAAQ,EAAE,SAAS,EAAE,OAAO,EAAE,WAAW,CAAC;IAClD,aAAa,EAAE,CAAC,OAAO,EAAE,EAAE;QAEzB,MAAM,YAAY,GAAG,OAAO,CAAC,KAAK,IAAI,OAAO,CAAC;QAE9C,OAAO;YACL,EAAE,EAAE,YAAY,CAAC,EAAE,IAAI,YAAY,CAAC,GAAG,IAAI,OAAO,CAAC,EAAE;YACrD,QAAQ,EAAE,YAAY,CAAC,kBAAkB;gBAC/B,YAAY,CAAC,iBAAiB;gBAC9B,YAAY,CAAC,IAAI;gBACjB,YAAY,CAAC,KAAK;gBAClB,OAAO,CAAC,QAAQ;YAC1B,KAAK,EAAE,YAAY,CAAC,IAAI;gBACjB,YAAY,CAAC,iBAAiB;gBAC9B,YAAY,CAAC,KAAK;gBAClB,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK;YACjC,WAAW,EAAE,YAAY,CAAC,WAAW;gBACxB,YAAY,CAAC,IAAI;gBACjB,OAAO,CAAC,WAAW;YAChC,SAAS,EAAE,YAAY,CAAC,KAAK,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC,CAAC,CAAC,EAAE,KAAK;YAC3D,GAAG,EAAE,OAAO;SACb,CAAC;IACJ,CAAC;CACF,CAAC","sourcesContent":["import { Strategy } from 'passport-azure-ad-oauth2';\nimport { normalizeEndpoint } from '../../mcp/utils/normalize-endpoint';\nimport { OAuthProviderConfig } from './oauth-provider.interface';\n\nexport const AzureADOAuthProvider: OAuthProviderConfig = {\n  name: 'azure-ad',\n  displayName: 'Microsoft Azure AD',\n  strategy: Strategy,\n  strategyOptions: ({ serverUrl, clientId, clientSecret, callbackPath }) => ({\n    clientID: clientId,\n    clientSecret: clientSecret,\n    callbackURL: normalizeEndpoint(`${serverUrl}/${callbackPath}`),\n    tenant: 'common', // Can be overridden via custom configuration\n    resource: 'https://graph.microsoft.com/', // Microsoft Graph API\n  }),\n  scope: ['openid', 'profile', 'email', 'User.Read'],\n  profileMapper: (profile) => {\n    // Azure AD profile structure from Microsoft Graph\n    const azureProfile = profile._json || profile;\n    \n    return {\n      id: azureProfile.id || azureProfile.oid || profile.id,\n      username: azureProfile.preferred_username ||\n                azureProfile.userPrincipalName || \n                azureProfile.mail || \n                azureProfile.email ||\n                profile.username,\n      email: azureProfile.mail || \n             azureProfile.userPrincipalName || \n             azureProfile.email ||\n             profile.emails?.[0]?.value,\n      displayName: azureProfile.displayName || \n                   azureProfile.name || \n                   profile.displayName,\n      avatarUrl: azureProfile.photo || profile.photos?.[0]?.value,\n      raw: profile,\n    };\n  },\n};\n"]}